<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Precioussly</title>
<meta property="og:type" content="website" />
<meta property="og:title" content="Precioussly — Handmade Jewellery" />
<meta property="og:description" content="Tap to view the product and buy." />
<meta property="og:image" content="https://i.postimg.cc/HnRbjRbh/Best-Logo.png" />
<meta property="og:url" content="https://precioussly.com/resin-necklace" />
<meta name="twitter:card" content="summary_large_image" />

<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&amp;display=swap" rel="stylesheet"/>
<style>
.quantity-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: white;
  width: fit-content;
  margin: 14px auto;
  padding: 4px 10px;
  gap: 16px;
}

.quantity-bar button {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: background 0.2s ease;
  outline: none !important;               /* ✅ Removes dotted focus */
  box-shadow: none !important;            /* ✅ No glow */
  -webkit-tap-highlight-color: transparent !important;  /* ✅ Remove Android/iOS grey flash */
  user-select: none;                      /* ✅ Prevents accidental text selection */
  touch-action: manipulation;            /* ✅ Better touch response */
}

.quantity-bar button:focus {
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
}

.quantity-bar button:active {
  background: transparent !important;
}



.quantity-display {
  font-size: 15px;
  min-width: 20px;
  text-align: center;
  font-family: 'Roboto Slab', serif;
  font-weight: 500;
  color: #222;
}
.icon-size {
  width: 10px;
  height: 10px;
}
body.noscroll {
  overflow: hidden;
  height: 100vh;
}
/* 👇 SIMPLE popup slider (fade only) */
#popupSlider{
  position: relative;
  min-height: 300px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;             /* no overflow peeking */
}

.popup-slide{
  position: absolute;
  inset: 0;
  width: 100%;
  max-width: 300px;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-radius: 14px;
  opacity: 0;
  transition: opacity 180ms ease-in-out;  /* ✅ only fade */
  pointer-events: none;
  z-index: 0;
}
.popup-slide.active{
  opacity: 1;
  pointer-events: auto;
  z-index: 1;
}

/* Dots – no width animation */
.popup-dots{
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
}
.popup-dot{
  width: 12px;
  height: 6px;
  border-radius: 10px;
  background: rgba(0,0,0,0.18);
}
.popup-dot.active{
  background: rgba(0,0,0,0.6);
}
.fixed-spinner-wrapper {
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.mini-spinner {
  width: 16px;   /* ✅ smaller spinner to match button height */
  height: 16px;
  border: 2px solid #fff;
  border-top: 2px solid rgba(255,255,255,0.2);
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  display: inline-block;
  vertical-align: middle;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
    body {
      margin: 0;
      font-family: 'Roboto Slab', serif;
      background: #ffffff;
      color: #222;
    }

    .section-title {
  font-size: 16px;         /* smaller font size */
  font-weight: 400;        /* normal font weight */
  text-align: center;
  padding: 14px 12px 8px;  /* reduced padding */
  background: #fff;
}

    
.product-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  padding: 10px;
}


    .product {
      position: relative;
    }

    
  .product img {
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 20px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

    
    .badge {
  position: absolute;
  top: 8px;
  left: 8px;
  background: #fbb6ce; /* light pink */
  color: #87003b;       /* dark pink for text */
  font-size: 11px;
  font-weight: 700;
  padding: 4px 8px;
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  font-family: 'Roboto Slab', serif;
}

    .product-info {
  margin-top: 4px;
  font-size: 14px;
  text-align: center;
  font-family: 'Roboto Slab', serif;
  line-height: 1.4;
}

    .product-info s {
      color: #999;
      margin-right: 6px;
    }

    .product-info b {
      color: #222;
      font-size: 15px;
    }

    .add-btn {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  margin-top: 6px;
  padding: 6px 12px;
  font-size: 13px;
  background: #2563eb;
  color: white;
  border: 1px solid #2563eb;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
  font-family: 'Roboto Slab', serif;

  width: 100px;          /* ✅ FIXED WIDTH */
  height: 36px;          /* ✅ FIXED HEIGHT */
  box-sizing: border-box;
}

    .add-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

.add-btn:hover {
  background: #2563eb;
  transform: none;
}
  
/* === HEADER + ANNOUNCEMENT BAR === */
.site-header {
  background-color: #ffffff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px; /* Reduced padding */
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
  min-height: 56px;   /* Same as index.html height */
}

.left-section {
  display: flex;
  align-items: center;
  gap: 10px;
}

.hamburger-wrapper {
  width: 22px;
  height: 18px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  background-color: transparent;
  border: none;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.hamburger-wrapper div {
  width: 100%;
  height: 2.6px;
  background-color: #000;
  border-radius: 2px;
}

.logo-img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
}

.right-icon {
  width: 32px;
  height: 32px;
  object-fit: cover;
  cursor: pointer;
  border-radius: 50%;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

#announcementBar {
  margin: 0;
  padding: 6px 10px;
  font-size: 13px;
  color: #ffffff;
  background: #000000;
  border-top: none;
  border-bottom: none;
  font-weight: 500;
  text-align: center;
  font-family: 'Roboto Slab', serif;
  min-height: 24px;
  line-height: 22px;
  user-select: none;
}
/* === Popup Animation & Layout (ULTRA SMOOTH) === */
#productPopup {
  /* overlay */
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.18);

  z-index: 9999;
  justify-content: center;
  align-items: center;

  opacity: 0;
  transition: opacity 320ms ease;
  will-change: opacity;
}
#productPopup.is-open { opacity: 1; }

.popup-card {
  background: #f7f7f7;
  border-radius: 20px;
  width: 90%;
  max-width: 320px;
  margin: 20px;
  padding: 16px;
  position: relative;
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);

  /* smoother start */
  transform: translateY(18px) scale(.975);
  opacity: 0;
  transform-origin: center;
  will-change: transform, opacity;
  transition:
    transform 1400ms cubic-bezier(.22,1,.36,1),
    opacity 420ms ease;
  contain: layout paint style;
}

.popup-card.enter {
  transform: translateY(0) scale(1);
  opacity: 1;
}

.popup-card.leave {
  transform: translateY(12px) scale(.97);
  opacity: 0;
}
.popup-card.enter {
  transform: translateY(0) scale(1);
  opacity: 1;
}
.popup-card.leave {
  transform: translateY(8px) scale(.985);
  opacity: 0;
}

/* Dots subtle */
.popup-dot { transition: background 200ms ease, width 240ms ease; }
.popup-dot.active { background: rgba(0,0,0,0.7); width: 22px; }

/* Micro-interactions */
.add-btn { transition: transform 120ms ease, box-shadow 120ms ease; }
.add-btn:active { transform: scale(.98); }
.quantity-bar button:active { transform: scale(.95); }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  #productPopup, .popup-card, .popup-slide, .add-btn { transition: none !important; }
}

/* === WhatsApp share button on popup === */




/* WhatsApp share button new position (right-bottom of photo) */
.popup-media{ position: relative; }

.wh-share {
  position: absolute;
  bottom: -35px; /* photo ke neeche le jane ke liye */
  right: 0;
  width: auto;
  height: auto;
  background: transparent;
  border: none;
  box-shadow: none;
}

.wh-share img {
  width: 50px;  /* 🔹 Bada size */
  height: 50px;
  display: block;
  object-fit: contain;
}
/* === Cart badge ultra-smooth pop === */
#cartCountBadge{
  transform-origin: center;
  will-change: transform;
  backface-visibility: hidden;
}
.bounce-badge{
  animation: badge-pop 1400ms cubic-bezier(.22,1,.36,1);
}
@keyframes badge-pop{
  0%   { transform: scale(0.92); }
  40%  { transform: scale(1.08); }
  70%  { transform: scale(0.98); }
  100% { transform: scale(1); }
}

/* === Auto Description (Details box) === */
.desc-box {
  margin: 10px 6px 0;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 12px;
  overflow: hidden;
}
.desc-box summary {
  list-style: none;
  cursor: pointer;
  padding: 12px 14px;
  font-weight: 700;
  font-size: 15px;
}
.desc-box summary::-webkit-details-marker { display: none; }
.desc-box[open] summary { border-bottom: 1px solid rgba(0,0,0,0.06); }
.desc-text {
  padding: 10px 16px 14px;
  font-size: 14px;
  line-height: 1.55;
}
.desc-text ul { margin: 0; padding-left: 18px; }
.desc-text li { margin: 8px 0; }


/* === Fixed popup size + inner scroll === */
.popup-card{
  max-height: 88vh;              /* card won't grow beyond this */
  display: flex;
  flex-direction: column;
}
.popup-body{
  overflow-y: auto;               /* scroll inside */
  -webkit-overflow-scrolling: touch;
  padding-bottom: 10px;
}

/* Summary chevron */
.desc-box summary {
  position: relative;
  padding-right: 28px;            /* room for chevron */
}
.desc-box summary::after{
  content: "";
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px; height: 8px;
  border-right: 2px solid #222;
  border-bottom: 2px solid #222;
  transform: translateY(-60%) rotate(-45deg); /* closed */
  transition: transform .2s ease;
}
.desc-box[open] summary::after{
  transform: translateY(-30%) rotate(45deg);  /* open */
}
/* Hide inner scrollbars (no thin line) */
.popup-body,
.desc-text {
  scrollbar-width: none;          /* Firefox */
  -ms-overflow-style: none;       /* Old Edge/IE */
  overscroll-behavior: contain;   /* no edge glow */
}
.popup-body::-webkit-scrollbar,
.desc-text::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;                  /* Chrome/Safari */
  background: transparent;
}
#cartCountBadge {
  font-family: 'Roboto Slab', serif !important;
  font-weight: 200; /* bold look */
  font-size: 14px;  /* adjust number size */
}

/* Hide dots container when empty (no dots added) */
.popup-dots:empty { display: none !important; }
</style>
<style>
/* Horizontal container: ultra-smooth, no jerks, iOS-like momentum */
body.horizontal-mode .product-grid{
  display: flex !important;
  flex-wrap: nowrap !important;
  gap: 12px !important;

  overflow-x: auto !important;
  -webkit-overflow-scrolling: touch !important; /* iOS smooth scrolling */
  scroll-behavior: smooth !important;
  touch-action: auto !important; /* ✅ allow pinch-zoom + normal scroll */
  overscroll-behavior-x: contain !important;

  scroll-snap-type: none !important;
  padding: 10px 12px 14px 12px !important; /* side padding */
}
body.horizontal-mode .product-grid::-webkit-scrollbar{ height: 0; }
body.horizontal-mode .product-grid{ scrollbar-width: none; }

/* ✅ Smaller card size for premium look */
body.horizontal-mode .product{
  min-width: 42vw;  /* was 47vw */
  max-width: 230px; /* was 260px */
  scroll-snap-align: none !important;
  display: flex !important;
  flex-direction: column !important;
}

/* Product image */
body.horizontal-mode .product img{
  width: 100% !important;
  aspect-ratio: 1 / 1 !important;
  height: auto !important;
  object-fit: cover !important;
  border-radius: 10px !important; /* sleeker corners */
  display: block !important;
}

/* Flexible content */
body.horizontal-mode .product .content,
body.horizontal-mode .product .details,
body.horizontal-mode .product .info{
  flex: 1 1 auto !important;
}

/* Buttons */
body.horizontal-mode .product .btn,
body.horizontal-mode .product button,
body.horizontal-mode .product .add-to-cart{
  margin-top: auto !important;
  width: 100% !important;
  box-sizing: border-box !important;
  padding: 9px 10px !important; /* slightly smaller padding */
  font-size: 13px !important;
  border-radius: 10px !important;
}

/* Title */
body.horizontal-mode .product h3,
body.horizontal-mode .product .title{
  font-size: 14px !important;
  line-height: 1.25 !important;
  margin: 7px 2px 3px !important;
  display: -webkit-box; 
  -webkit-line-clamp: 1; 
  -webkit-box-orient: vertical; 
  overflow: hidden;
}

/* Price */
body.horizontal-mode .product .price,
body.horizontal-mode .product .price-row{
  font-size: 12px !important;
}
</style>
<style>
/* ===== Mode 3: horizontal swipe + smaller product cards ===== */
body.horizontal-mode.small-cards .product-grid{
  gap: 10px !important;
  padding: 8px 10px 12px 10px !important;
}
body.horizontal-mode.small-cards .product{
  min-width: 34vw !important;   /* smaller than mode 2 */
  max-width: 200px !important;   /* smaller than mode 2 */
}
body.horizontal-mode.small-cards .product img{
  border-radius: 10px !important;
}
body.horizontal-mode.small-cards .product h3,
body.horizontal-mode.small-cards .product .title{
  font-size: 13px !important;
}
body.horizontal-mode.small-cards .product .price,
body.horizontal-mode.small-cards .product .price-row{
  font-size: 12px !important;
}
body.horizontal-mode.small-cards .product .btn,
body.horizontal-mode.small-cards .product button,
body.horizontal-mode.small-cards .product .add-to-cart{
  padding: 8px 10px !important;
  font-size: 12.5px !important;
}
</style>

<style>

/* === Side Menu (same as index.html look) === */
.menu-overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.45);
  display:none; z-index:4000;
  opacity:0; transition:opacity .35s cubic-bezier(.22,1,.36,1);
}
.menu-overlay.active{ display:block; opacity:1; }

.side-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 70vw;
  max-width: 280px;
  height: 100vh;
  background: #fff;
  box-shadow: 4px 0 16px rgba(0, 0, 0, 0.1);
  padding: 16px 12px;
  overflow-y: auto;
  transform: translateX(-100%);
  transition: transform 0.8s cubic-bezier(.25, 1, .3, 1);
  z-index: 5000;
  font-family: 'Roboto Slab', serif;
}

.side-menu.active {
  transform: translateX(0);
}

.menu-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:6px 4px 12px; border-bottom:1px solid #eaeaea; margin-bottom:12px;
}
.menu-title{ font-size:18px; font-weight:600; color:#000; font-family:'Roboto Slab', serif; }
.menu-close{
  width:36px; height:36px; display:flex; align-items:center; justify-content:center;
  border:1px solid #000; border-radius:10px; font-size:18px; font-weight:700; color:#000;
  cursor:pointer; -webkit-tap-highlight-color:transparent;
}

/* Unified button list (green first button) */
#sideMenu #menuContent{ display:flex; flex-direction:column; gap:10px; padding:8px 16px 18px; }
#sideMenu .menu-link{
  display:block; text-align:center; padding:10px 14px;
  border:1px solid #dcdcdc; border-radius:12px; background:#fff;
  color:#111; font-family:'Roboto Slab', serif; font-size:17px; font-weight:500; text-decoration:none;
  box-shadow:0 1px 2px rgba(0,0,0,.03);
}
#menuContent .menu-link:first-child{
  background:#e9fef1; border:1.5px solid #c5ecd6; color:#064c2c; font-weight:600;
}

</style>


<style>
/* ==== Floating action buttons (WhatsApp + Top) ==== */
.fab-stack{position:fixed;right:10px;bottom:14px;display:flex;flex-direction:column;gap:12px;z-index:6000;pointer-events:none}
.fab-btn{width:56px;height:56px;border-radius:50%;border:1px solid rgba(0,0,0,.15);background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.18);display:flex;align-items:center;justify-content:center;pointer-events:auto;-webkit-tap-highlight-color:transparent}
#toTopBtn{width:55px;height:55px;border-radius:50%;border:1px solid rgba(0,0,0,.15);background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.18);display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0}
#toTopBtn svg{width:26px;height:26px}
#waBtn{width:55px;height:55px;border:none;border-radius:0;background:none;box-shadow:none;display:flex;align-items:center;justify-content:center;padding:0}
#waBtn img{display:block;width:100%;height:100%;object-fit:contain}

/* ==== Smart header (hide on scroll down, show on scroll up) ==== */
.site-header{position:sticky;top:0;z-index:3500;transition:transform .35s ease;will-change:transform;backface-visibility:hidden}
.site-header.header-hidden{transform:translateY(-100%)}

/* Basic overlay + side-menu container (no blur) */
.menu-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s ease;
  z-index: 3990;
}
.menu-overlay.open {
  opacity: 1;
  pointer-events: auto;
}
.side-menu {
  position: fixed;
  inset: 0 0 0 auto;
  width: min(70vw, 300px); /* reduced from 88vw, 420px */
  max-width: 300px;       /* was 420px */
  background: #fff;
  transform: translateX(100%);
  transition: transform 0.3s ease;
  z-index: 4000;
  box-shadow: -20px 0 40px rgba(0, 0, 0, 0.2);
}
.side-menu.open {
  transform: translateX(0);
}
.menu-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 18px;
  border-bottom: 1px solid #eee;
}
.menu-title {
  font-size: 18px;       /* reduced from 28px */
  font-weight: 600;      /* slightly lighter */
}

.menu-close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;           /* reduced from 42px */
  height: 32px;          /* reduced from 42px */
  border: 1px solid #111;
  border-radius: 10px;   /* slightly smaller radius for proportion */
  font-size: 14px;       /* smaller ✕ icon */
  cursor: pointer;
}
#menuContent {
  padding: 18px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}
#menuContent .menu-item {
  display: block;
  padding: 14px 16px;
  border: 1px solid #e8e8e8;
  border-radius: 16px;
  font-size: 22px;
  font-weight: 700;
  text-align: center;
}

</style>

<style>
/* === FIX: Left-side menu like index.html (smaller) === */
.menu-overlay{
  opacity:0; display:none;
  transition: opacity .35s cubic-bezier(.22,1,.36,1) !important;
}
.menu-overlay.active{ display:block; opacity:1; }

/* Drawer from LEFT, smaller width */
.side-menu{
  left:0 !important; right:auto !important;
  width:84vw !important; max-width:360px !important;
  height:100vh; top:0; position:fixed;
  transform: translateX(-100%) !important;
  transition: transform .6s cubic-bezier(.25,1,.3,1) !important;
  box-shadow: 4px 0 16px rgba(0,0,0,.12) !important;
  padding:16px 12px !important;
}
.side-menu.active{ transform: translateX(0) !important; }
/* Paste this AFTER all previous .side-menu CSS */
nav.side-menu {
  width: min(74vw, 270px) !important;
  max-width: 270px !important;
  padding: 12px 10px !important;
  box-shadow: -20px 0 40px rgba(0, 0, 0, 0.2) !important;
}

#menuContent {
  padding: 8px 12px 14px !important;
  gap: 10px !important;
}

.menu-header {
  padding: 14px 14px !important;
}
</style>
<style>
/* ===== Header Search (inline) ===== */
.header-search{ display:none; align-items:center; gap:8px; width:100%; }
.header-search input{
  flex:1; padding:12px 14px; font:400 16px 'Roboto Slab', serif;
  border:1px solid #d9d9d9; border-radius:12px; outline:none; background:#fff;
}
.header-search input:focus{ border-color:#bfbfbf; }

/* Back pill button */
#headerSearchBack{
  height:36px; padding:0 14px; font:500 14px 'Roboto Slab', serif; color:#222;
  background:#fff; border:1px solid rgba(0,0,0,.18); border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.06); cursor:pointer; -webkit-tap-highlight-color:transparent;
}

/* Searching mode: logo/menu/icons hide, input row show */
.site-header.searching .hamburger-wrapper,
.site-header.searching #logoWrap,
.site-header.searching #rightIcons{ display:none !important; }
.site-header.searching #headerSearchBar{ display:flex !important; }

/* Suggestions box: search bar ke BILKUL niche */
#headerSearchBar{ position:relative; }
#headerSearchResults{
  position:absolute; top:calc(100% + 10px); left:0; right:0;
  display:none; background:#fff; border:1px solid #eaeaea; border-radius:12px;
  box-shadow:0 8px 22px rgba(0,0,0,0.08); max-height:62vh; overflow:auto; padding:6px; z-index:4000;
}
.header-suggest{
  display:grid; grid-template-columns:56px 1fr auto; gap:10px; align-items:center;
  padding:8px; border-radius:10px;
}
.header-suggest:hover{ background:#f9f9f9; }
.header-suggest img{ width:56px; height:56px; border-radius:10px; object-fit:cover; }
.header-suggest .name{ font-size:14px; font-weight:600; }
.header-suggest .price{ font-size:13px; color:#111; }
.header-suggest .tag{ font-size:11px; padding:3px 6px; border:1px solid #ddd; border-radius:8px; color:#333; }

/* Header sticky (already present; ensure z-index high) */
.site-header{ position:sticky; top:0; z-index:3500; }
</style>

<!-- === NO-ANIMATION OVERRIDES (injected) === -->



<style>
/* ===== Title truncation + consistent button alignment ===== */
.product, .product-card{
  display: flex !important;
  flex-direction: column !important;
}
.product .card-body, .product-card .card-body,
.product .details, .product-card .details{
  display: flex !important;
  flex-direction: column !important;
  gap: 6px;
  height: 100%;
}

/* Single-line ellipsis for long product names */
.product h3, .product .title, .product-card h3, .product-card .title{
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  min-height: 1.35em; /* reserve height so rows align */
}

/* Keep price row compact */
.product .price-row, .product-card .price-row{
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Always pin Add to Cart to the bottom of card */
.product .add-to-cart, .product-card .add-to-cart,
.product button.add-to-cart, .product-card button.add-to-cart,
.product .btn.add-to-cart, .product-card .btn.add-to-cart,
.product .btn-primary, .product-card .btn-primary{
  margin-top: auto !important;
}

/* Ensure the product card itself has a minimum height so buttons line up in rows */
.product, .product-card{
  min-height: 360px; /* adjust if your cards are taller/shorter */
}
/* In Mode 3 (small-cards), use a smaller minimum height */
body.horizontal-mode.small-cards .product,
body.horizontal-mode.small-cards .product-card{
  min-height: 300px;
}
</style>


<style>
/* ===== Alignment hotfix: ensure buttons align and names truncate ===== */
.product{
  display:flex !important;
  flex-direction:column !important;
}
.product .product-info{
  display:flex !important;
  flex-direction:column !important;
  gap:6px;
  flex: 1 1 auto; /* grow to fill remaining space */
}
.product .product-title{
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  display: block;
  min-height: 1.35em;
}
.product .add-btn{  /* the actual Add to Cart button in grid */
  margin-top: auto !important;
}
</style>


<style>
/* ===== Final alignment fix: force consistent card height and button position ===== */
.product{
  display:flex !important;
  flex-direction:column !important;
  justify-content:space-between !important;
}
.product .product-info{
  flex-grow:1 !important;
  display:flex !important;
  flex-direction:column !important;
  justify-content:flex-start !important;
}
.product .add-btn{
  align-self:stretch !important;
  margin-top:auto !important;
}
/* Ensure all product cards in a row have the same height */
.product-grid{
  align-items:stretch !important;
}
</style>


<style>
/* ===== Spacing fix: product info should hug image ===== */
.product img{
  display:block;
  margin-bottom:6px !important; /* tighten space below image */
}
.product .product-info{
  margin-top:0 !important;
  padding-top:0 !important;
}
.product .product-title{
  margin-top:0 !important;
  padding-top:0 !important;
}
</style>


<style>
/* ===== Compact spacing: remove unnecessary whitespace below images ===== */
.product img{
  display:block;
  margin:0 !important;
  padding:0 !important;
  object-fit:contain;
}
.product .image-wrapper,
.product .product-image{
  margin:0 !important;
  padding:0 !important;
  line-height:0 !important;
}
.product .product-info{
  margin-top:4px !important; /* minimal gap only */
}
</style>


<style>
/* ===== Remove gap between photo and info ===== */
.product{
  justify-content: flex-start !important; /* previously space-between created big gap */
}
/* Keep the button at the bottom only */
.product .add-btn{
  margin-top: auto !important;
}
</style>


<style>
/* ===== Equal spacing for section titles ===== */
.section-title, h2, h3 {
  margin-top: 20px !important;
  margin-bottom: 20px !important;
  line-height: 1.4;
  text-align: center;
}
</style>


<style>
/* ===== Minimal spacing for section titles ===== */
.section-title, h2, h3 {
  margin-top: 6px !important;
  margin-bottom: 8px !important;
  line-height: 1.3;
  text-align: center;
}
</style>


<style id="layout-fix-0818">
/* === Layout fix to match the second screenshot === */
.product-grid{display:grid !important; grid-template-columns:1fr 1fr !important; gap:14px !important; padding:10px !important;}
.product{display:flex !important; flex-direction:column !important; justify-content:flex-start !important; min-height:360px !important;}
.product img{display:block !important; margin:0 !important; padding:0 !important; border-radius:12px !important; object-fit:cover !important; aspect-ratio:1/1 !important;}
.product .product-title{font-size:14px !important; text-align:left !important; margin:8px 6px 0 !important; white-space:nowrap !important; overflow:hidden !important; text-overflow:ellipsis !important;}
.product .product-info{margin-top:4px !important; padding:0 6px !important; text-align:left !important; display:flex !important; flex-direction:column !important; gap:6px !important; flex:1 1 auto !important;}
.product .price-row{display:flex !important; align-items:center !important; gap:8px !important;}
.add-btn{margin-top:auto !important; width:110px !important; height:38px !important; align-self:center !important;   /* ✅ Centered */}
/* equal spacing for section headings */
.section-title{font-size:16px !important; font-weight:400 !important; text-align:center !important; padding:14px 12px 8px !important;}
</style>


<style>
/* === Reduce spacing for section titles === */
.section-title {
  margin-top: 2px !important;
  margin-bottom: 2px !important;
  padding: 0 !important;
  line-height: 1.2 !important;
}

/* === Reduce spacing inside product cards === */
.product .product-info {
  gap: 2px !important;        /* minimal gap between price and button */
  margin-top: 0 !important;   /* remove top margin */
  padding: 0 6px !important;
}

.product .add-btn {
  margin-top: 2px !important; /* reduce space before Add to Cart */
}
</style>


<style id="zero-gaps-0818">
/* ===== Force-zero extra space below cards & between sections ===== */

/* Collapse any forced card height so there is no blank area under the button */
.product, .product-card,
body.horizontal-mode .product,
body.horizontal-mode.small-cards .product {
  min-height: 0 !important;
  height: auto !important;
  padding-bottom: 0 !important;
  margin-bottom: 0 !important;
}

/* Remove any bottom space inside info/button area */
.product .product-info {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
  gap: 2px !important;
}
.product .add-btn {
  margin-top: 2px !important;
  margin-bottom: 8px !important;
}

/* Make vertical gaps between rows extremely small */
.product-grid {
  row-gap: 4px !important;  /* vertical gap */
  column-gap: 12px !important; /* keep side gap comfortable */
  gap: 4px 12px !important; /* ensure browsers honor both */
}

/* Minimize spacing for headings and between a grid and the next heading */
.section-title {
  margin-top: 4px !important;
  margin-bottom: 4px !important;
  padding: 0 !important;
  line-height: 1.2 !important;
}
.product-grid + .section-title {
  margin-top: 4px !important;
}
</style>


<style id="center-add-btn-override-0818">
/* Force-center Add to Cart button inside product cards */
.product .add-btn{
  align-self: center !important;
  margin-left: auto !important;
  margin-right: auto !important;
}
/* Extra gap between announcement bar and first section title */
.section-title:first-of-type {
  margin-top: 12px !important;  /* adjust this value as needed */
}

</style>


<style id="pinch-zoom-fix-aug18">
/* === Pinch-zoom fix: keep zoom enabled on horizontal modes (2 & 3) === */
body.horizontal-mode .product-grid{
  touch-action: auto !important;    /* allow pinch-zoom */
}
/* Some browsers require explicit pinch-zoom token; harmless where unsupported */
@supports (touch-action: pinch-zoom) {
  body.horizontal-mode .product-grid{
    touch-action: pinch-zoom pan-x pan-y !important;
  }
}
</style>
<!-- LIVE DRAG SLIDER (natural swipe) -->
<style id="live-drag-slider-css">
#popupSlider{
  position: relative !important;
  overflow: hidden !important;
  min-height: 300px !important;
  touch-action: pan-y !important;
  cursor: grab;
}
#popupSlider.dragging{ cursor: grabbing; }
#popupSlider .popup-track{
  display: flex;
  width: 100%;
  height: 100%;
  transition: transform 1400ms cubic-bezier(.22,1,.36,1);
  will-change: transform;
}
#popupSlider .popup-slide{
  position: relative !important;
  inset: auto !important;
  width: calc(100% - 10px) !important;  /* slide width shrinks by 10px */
  max-width: none !important;
  flex: 0 0 calc(100% - 10px) !important;
  margin: 0 5px;   /* 👈 equal left & right spacing */
  aspect-ratio: 1 / 1 !important;
  border-radius: 14px !important;
  object-fit: cover !important;
  opacity: 1 !important;
  z-index: auto !important;
  pointer-events: auto !important;
  transition: none !important;
  user-select: none !important;
}

.popup-dots{ display:flex; justify-content:center; gap:8px; margin-top:10px; }
.popup-dot{ width:12px; height:6px; border-radius:10px; background:rgba(0,0,0,.18); }
.popup-dot.active{ background:rgba(0,0,0,.6); width:22px; transition: background 200ms ease, width 240ms ease; }
</style>





<style id="premium-title-lines">
/* ===== Ultra-sleek divider lines for section titles ===== */
.section-title{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  gap:10px !important;
  font-family:'Roboto Slab', serif !important;
  font-size:17px !important;
  font-weight:500 !important;
  color:#111 !important;
  background:#fff !important;
  margin:16px 8px 12px 8px !important;
  padding:6px 6px !important;
  line-height:1.3 !important;
  letter-spacing:0.2px !important;
}

.section-title::before,
.section-title::after{
  content:"" !important;
  flex:1 !important;
  height:1px !important;              /* ✅ thinner line */
  border-radius:1px !important;
  background:linear-gradient(to right, rgba(0,0,0,0), #111, rgba(0,0,0,0)) !important;
}

.section-title::after{
  background:linear-gradient(to left, rgba(0,0,0,0), #111, rgba(0,0,0,0)) !important;
}

/* Tighten spacing between a grid and the next title */
.product-grid + .section-title{ margin-top:10px !important; }
</style>






<style id="photo-dots-pink">
/* ===== In-photo premium pink dots (ultra-minimal) ===== */
.popup-media{ position: relative !important; }

/* Container: sits INSIDE the photo at the bottom */
.popup-dots{
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  display: inline-flex;
  gap: 6px;
  padding: 4px 6px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.10);       /* subtle glass */
  -webkit-backdrop-filter: blur(3px);
  backdrop-filter: blur(3px);
  border: 1px solid rgba(255,255,255,0.28);
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  pointer-events: auto;                         /* allow tap */
  z-index: 3;
}

/* Dots: tiny, light pink theme */
.popup-dot{
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: linear-gradient(180deg, #ffe3ee 0%, #f7c5d8 100%);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.9),
    0 1px 2px rgba(0,0,0,0.12);
  opacity: 0.75;
  transform: translateZ(0) scale(1);
  transition:
    opacity 220ms ease,
    transform 1400ms cubic-bezier(.22,1,.36,1),
    box-shadow 1400ms cubic-bezier(.22,1,.36,1);
  will-change: transform, opacity;
}

/* Active state: slightly larger with soft glow */
.popup-dot.active{
  opacity: 1;
  transform: scale(1.35);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,1),
    0 2px 6px rgba(234, 86, 146, 0.35);
}

/* Respect users who prefer less motion */
@media (prefers-reduced-motion: reduce){
  .popup-dot{ transition: none !important; }
}
</style>

<style id="dot-circle-override">
/* ===== FINAL OVERRIDE: perfect circular pink dots (no pills) ===== */
.popup-media{ position: relative !important; }
.popup-dots{
  position: absolute !important;
  left: 50% !important;
  bottom: 10px !important;
  transform: translateX(-50%) !important;
  display: inline-flex !important;
  gap: 6px !important;
  padding: 4px 6px !important;
  border-radius: 14px !important;
  background: rgba(255,255,255,0.10) !important;
  -webkit-backdrop-filter: blur(3px) !important;
  backdrop-filter: blur(3px) !important;
  border: 1px solid rgba(255,255,255,0.28) !important;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08) !important;
  pointer-events: auto !important;
  z-index: 3 !important;
}
/* Always circles */
.popup-dot{
  width: 8px !important;
  height: 8px !important;
  border-radius: 50% !important;
  background: linear-gradient(180deg, #ffe3ee 0%, #f7c5d8 100%) !important;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.9),
    0 1px 2px rgba(0,0,0,0.12) !important;
  opacity: 0.9 !important;
  transform: scale(1) !important;
  transition:
    transform 1400ms cubic-bezier(.22,1,.36,1),
    opacity 220ms ease !important;
}
/* Active: slightly bigger circle (still circle) */
.popup-dot.active{
  opacity: 1 !important;
  transform: scale(1.25) !important;
}
/* Never animate width/shape anywhere */
.popup-dot, .popup-dot.active{
  width: 8px !important;
  height: 8px !important;
}
/* Hide when only one image */
.popup-dots:empty, .popup-dots.hide { display: none !important; }
@media (prefers-reduced-motion: reduce){
  .popup-dot{ transition: none !important; }
}
</style>



<style id="dot-blue-override">
/* ===== DOTS: Blue Theme ===== */
.popup-dot{
  background: linear-gradient(180deg, #b3d9ff 0%, #3399ff 100%) !important; /* light to medium blue */
}
.popup-dot.active{
  background: linear-gradient(180deg, #3399ff 0%, #0066cc 100%) !important; /* darker blue active */
}
</style>



<style id="dot-blue-position">
/* ===== DOTS: Corrected position (not too high) ===== */
.popup-dots{
  bottom: 18px !important; /* balanced position */
}
</style>
<style id="plain-desc-css">
/* ===== Plain Description (refined, no underline) ===== */
.desc-section{
  margin: 8px 8px 0;
  text-align: center;
  background: transparent;
}
.desc-title{
  font-weight: 700;
  font-size: 13.5px;
  line-height: 1.2;
  margin: 2px 0 4px;
  letter-spacing: .2px;
  color: #111;
}
/* removed underline */
.desc-content{font-size: 12.5px;        /* slightly smaller for SEO copy */
  line-height: 1.55;
  height:auto; overflow:visible;           /* scroll inside if long */
  padding: 0 4px 0;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;    /* Firefox hide scrollbar */
  max-width: 92%;
  margin: 0 auto;
  text-align: left;         /* more readable */
  color: #444;
  white-space: pre-wrap;}


/* Make popup content the single scroll container */
.popup-card{
  overflow-y: auto;
  max-height: 86vh;
  -webkit-overflow-scrolling: touch;
}

</style>

<style id="alignment-fix-0901b">
  #popupName { margin: 2px 12px 2px 12px !important; }
  #popupPrice { margin: 0 12px 10px 12px !important; }
</style>
<style>
  /* Instagram follow banner */
  .ig-banner-wrap{ padding: 0 12px 18px; background:#fff; }
  .ig-banner{
    background:#f6efe8; border:1px solid #f1e7df; border-radius:18px;
    padding:22px 18px; max-width:960px; margin:12px auto 0;
    text-align:center; box-shadow:0 2px 6px rgba(0,0,0,.05);
  }
  .ig-banner p{
    margin:0 0 14px; font-size:18px; line-height:1.55; font-weight:600;
    letter-spacing:.2px; color:#1b1b1b; font-family:'Roboto Slab', serif;
  }
  .ig-banner .ig-link{ display:inline-block; line-height:0; border-radius:14px; padding:6px; transition:transform .15s ease; }
  .ig-banner .ig-link:active{ transform:scale(.96); }
  .ig-banner .ig-icon{ width:36px; height:36px; }
</style>
<style id="pink-profile-popup-css">

/* === Pink Profile Popup (ChatGPT Resin) === */
.pp-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:7000;}
.pp-overlay.show{display:block;}
.pp-card{
  position: fixed; left:50%; top:18%;
  transform: translateX(-50%);
  width: min(92vw, 420px);
  background:#fff;
  border:2px solid #ff6ea8;
  border-radius: 22px;
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  padding: 18px 16px 16px;
  font-family: 'Roboto Slab', serif;

  margin-left:15px; margin-right:15px; width: calc(100% - 30px);}
.pp-hero{display:flex;justify-content:center;align-items:center;margin-top:6px;margin-bottom:6px;}
.pp-hero .pp-badge{
  width:58px;height:58px;border-radius:50%;display:grid;place-items:center;
  background:linear-gradient(135deg,#ffe1ef,#ffd4ea 50%, #ffc1e1);
  border:1.5px solid #ff8fbe;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.9), 0 6px 16px rgba(255,110,168,.25);
  font-size:30px; line-height:1;
}
.pp-title{font-size:20px; font-weight:800; color:#111; text-align:center; margin:8px 0 6px;}
.pp-sub{font-size:15px; color:#3a3a3a; text-align:center; line-height:1.6; padding:0 8px;}
.pp-cta{
  display:block; width:100%; text-align:center; text-decoration:none;
  margin:14px 0 2px; padding:12px 14px; border-radius:14px;
  background:#ff6ea8; color:#fff; font-weight:800; border:1px solid #ff4d98;
  box-shadow:0 8px 18px rgba(255,110,168,.28);
}
.pp-cta:active{transform:scale(.985);}
.pp-back{
  position:absolute; right:10px; top:10px;
  height:34px; padding:0 12px; border-radius:10px; cursor:pointer;
  font:600 14px/1 'Roboto Slab', serif; color:#ff2f90;
  background:#fff; border:1px solid rgba(255,47,144,.5);
  box-shadow: 0 3px 10px rgba(255,47,144,.15);
}
.pp-back:active{transform:scale(.98);}
@media (max-width:420px){
  .pp-card{top:14%;
  margin-left:15px; margin-right:15px; width: calc(100% - 30px);}
}


/* --- FORCE margins 15px L/R on popup --- */
.pp-card{
  box-sizing: border-box !important;
  left: 50% !important;
  right: auto !important;
  transform: translateX(-50%) !important;
  width: calc(100vw - 30px) !important;   /* viewport width minus 15px+15px */
  max-width: 420px !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* --- Ensure Track button respects same left/right margin --- */
.pp-card .pp-cta{
  width: auto !important;
  display: block !important;
  margin-left: 15px !important;
  margin-right: 15px !important;
}
</style>
</head>
<body>
<header class="site-header">
  <div class="hamburger-wrapper" onclick="toggleMenu()">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <div id="logoWrap" style="display: flex; align-items: center; position: absolute; left: 70px; top: 6px;">

    <img
      src="https://i.postimg.cc/HnRbjRbh/Best-Logo.png"
      alt="Precioussly Logo"
      onclick="location.href = 'https://precioussly.com';"
      style="
        width: 110px;
        height: auto;
        object-fit: contain;
        cursor: pointer;
        transition: opacity 0.3s ease;
        -webkit-tap-highlight-color: transparent;
      "
    />
  </div>

  <div id="rightIcons" style="display: flex; align-items: center; gap: 12px;">
    <!-- Search icon -->
    <img
      src="https://i.postimg.cc/mZq01NH8/IMG-20250801-072508.jpg"
      alt="Search"
      class="right-icon"
      style="border-radius: 0; width: 25px; height: 26px; margin-top: 2px;"
      onclick="openHeaderSearch()"
    />

    <!-- Profile icon -->
    <img
      id="profileIcon"
      src="https://i.postimg.cc/1tRZMmmB/Profile-Icon.png"
      alt="Profile"
      class="right-icon icon-size"
      onclick="handleProfileClick()"
      style="cursor: pointer;"
    />

    <!-- Cart icon with badge -->
    <a href="https://www.precioussly.com/cart" style="position: relative; display: inline-block; margin-top: 5px;">
      <img
        src="https://i.postimg.cc/MZF8bJh0/Cart-Icon.png"
        alt="Cart"
        class="right-icon icon-size"
      />
      <span
        id="cartCountBadge"
        style="position: absolute; top: -6px; right: -6px; background: white; color: black; font-size: 12px; border: 1px solid grey; border-radius: 50%; width: 19px; height: 19px; display: flex; align-items: center; justify-content: center;"
      >0</span>
    </a>
  </div>

  <!-- 🔎 Inline header search row -->
  <div id="headerSearchBar" class="header-search">
    <input
      id="headerSearchInput"
      type="text"
      placeholder="Search products..."
      autocomplete="off"
    />
    <button
      id="headerSearchBack"
      class="back-btn"
      type="button"
      onclick="closeHeaderSearch()"
    >Back</button>
    <div id="headerSearchResults"></div>
  </div>
</header>
<!-- Announcement Bar -->
<div id="announcementBar">🧿</div>

<!-- Menu overlay + drawer (same as index.html) -->
<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

<nav class="side-menu" id="sideMenu">
  <div class="menu-header">
    <span class="menu-title">Menu</span>
    <span class="menu-close" onclick="toggleMenu()">✕</span>
  </div>
  <!-- Buttons from Google Sheet will be injected here -->
  <div id="menuContent"></div>
</nav>


<div id="content"></div>
<script>
(async function () {
  // --- helper to fetch JSON ---
  async function fetchJSON(url) {
    const r = await fetch(url);
    if (!r.ok) throw new Error("Network error: " + r.status);
    return r.json();
  }

  // === PASTE YOUR GOOGLE SHEET LINK + TAB NAME HERE ===😎😎😎😎
  const PASTED_SHEET_LINK =
    "https://docs.google.com/spreadsheets/d/1PFz3c1VNcmFo5NkN1xdpCyYxJJGxMlxt1Aw_tWv56nA/edit?usp=drivesdk";
  const TAB_NAME = "Resin Necklace"; // 👈 Yahan apna tab name likho (e.g. "Products", "Necklace")😎😎😎😎

  // --- extract spreadsheet ID ---
  const idMatch = PASTED_SHEET_LINK.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
  if (!idMatch) {
    console.error("❌ Invalid Google Sheet URL:", PASTED_SHEET_LINK);
    return;
  }
  const sheetId = idMatch[1];

  // --- final opensheet URL ---
  const DATA_URL = `https://opensheet.elk.sh/${sheetId}/${encodeURIComponent(TAB_NAME)}`;
  console.log("✅ Final working Sheet URL:", DATA_URL);

  // --- fetch products ---
  const data = await fetchJSON(DATA_URL);

  // preserve for popup deep-link
  window.__activeSheet = { sheetId, tab: TAB_NAME, url: DATA_URL };

  // optional direction toggle
  if (typeof applyDirectionFromSheet === "function") {
    try { applyDirectionFromSheet(data); } catch (e) {}
  }

  window.catalogData = data;
  const content = document.getElementById("content");
  let currentSection = "";
  let sectionWrapper;
  let currentSectionHidden = false;

  data.forEach((item) => {
    // --- Section header row ---
    if (item["Section"]) {
      currentSection = item["Section"];
      const secVis = String(item["visibility"] || item["Visibility"] || "")
        .trim()
        .toLowerCase();
      currentSectionHidden = secVis.includes("hide");
      if (currentSectionHidden) { sectionWrapper = null; return; }

      const sectionTitle = document.createElement("div");
      sectionTitle.className = "section-title";
      sectionTitle.innerText = currentSection;
      content.appendChild(sectionTitle);

      sectionWrapper = document.createElement("div");
      sectionWrapper.className = "product-grid";
      content.appendChild(sectionWrapper);
      return; // this row only section title
    }

    if (currentSectionHidden) return;
    if (typeof isHidden === "function" && isHidden(item)) return;
    if (!item["Product Name"]) return;

    // --- Product card ---
    const product = document.createElement("div");
    product.className = "product";

    product.addEventListener("click", (e) => {
      if (e.target.closest(".add-to-cart, .quantity-bar, button")) return;
      const allPhotos = [item["photo 1"], item["photo 2"], item["photo 3"], item["photo 4"]].filter(Boolean);
      if (typeof openPopup === "function") {
        openPopup(allPhotos, item["Product Name"], item["MRP"], item["Selling Price"], item["in stock"], getSheetDescription(item));
      }
    });

    const img = document.createElement("img");
    img.src = item["photo 1"];
    img.alt = item["Product Name"];
    img.style.pointerEvents = "none";
    img.style.cursor = "default";
    product.appendChild(img);

    const infoWrapper = document.createElement("div");
    infoWrapper.style.padding = "0 6px";

    const title = document.createElement("div");
    title.className = "product-title";
    title.style.fontSize = "14px";
    title.style.textAlign = "left";
    title.style.marginTop = "8px";
    title.innerText = item["Product Name"];
    infoWrapper.appendChild(title);

    if (item["Badge"]) {
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.innerText = item["Badge"];
      product.appendChild(badge);
    }

    const info = document.createElement("div");
    info.className = "product-info";

    let priceHTML = "";
    if (item["MRP"] && item["Selling Price"]) {
      priceHTML = `
        <div style="
          text-align:left;
          font-size:14px;
          font-weight:bold;
          display:flex;
          gap:6px;
          align-items:center;
          white-space:nowrap;
          overflow:hidden;
          text-overflow:ellipsis;
        ">
          <span>₹${item["Selling Price"]}</span>
          <s style="color:#999; font-weight:normal;">₹${item["MRP"]}</s>
        </div>`;
    }

    if (+item["in stock"] === 0) {
      info.innerHTML = `
        ${priceHTML}
        <button class="add-btn" disabled style="background:#f1f1f1; color:#888; border:1px solid #ccc;">Out of Stock</button>`;
    } else {
      const productData = {
        photo: item["photo 1"],
        name: item["Product Name"],
        mrp: item["MRP"],
        price: item["Selling Price"],
      };
      info.innerHTML = `
        ${priceHTML}
        <button class="add-btn" onclick='addToCartFromGrid(this, ${JSON.stringify(productData)})'>Add to Cart</button>`;
    }

    infoWrapper.appendChild(info);
    product.appendChild(infoWrapper);

    if (!sectionWrapper) {
      sectionWrapper = document.createElement("div");
      sectionWrapper.className = "product-grid";
      content.appendChild(sectionWrapper);
    }
    sectionWrapper.appendChild(product);
  });

  if (typeof maybeOpenFromURL === "function") {
    try { maybeOpenFromURL(); } catch (e) {}
  }
})();
</script>


<script>
  function getParam(name) {
    const u = new URLSearchParams(location.search);
    return u.get(name);
  }
  function maybeOpenFromURL() {
    const wanted = getParam('p');
    if (!wanted || !window.catalogData) return;
    const wantedLower = decodeURIComponent(wanted).toLowerCase();
    const item = window.catalogData.find(row =>
      (row["Product Name"] || "").toLowerCase() === wantedLower
    );
    if (!item) return;
    const images = [item["photo 1"], item["photo 2"], item["photo 3"], item["photo 4"]].filter(Boolean);
    openPopup(images, item["Product Name"], Number(item["MRP"]), Number(item["Selling Price"]), Number(item["in stock"]), getSheetDescription(item));
  }
</script>

<div id="productPopup">
  <div class="popup-card" onclick="event.stopPropagation()">
<div class="popup-body">



<!-- Close button -->

<!-- Square image 1:1 -->
<!-- Sliding photos here -->
<div class="popup-media">
  <div id="popupSlider"></div>
  <div id="popupDots" class="popup-dots" aria-hidden="true"></div>
  <a id="whShare" class="wh-share" href="#" target="_blank" rel="noopener" aria-label="Share on WhatsApp">
    <img src="https://i.postimg.cc/fLMF5X4j/file-00000000fcd061f8a087874368df7c79.png" alt="Share on WhatsApp">
  </a>
</div><!-- Product name on left -->
<div id="popupName" style="font-size:16px; font-weight:600; text-align:left; margin: 2px 12px 2px 12px;"></div>
<!-- Price -->
<div id="popupPrice" style="margin: 0 12px 10px 12px; font-size:14px; text-align:left;"></div>
<!-- Quantity Bar -->
<!-- Auto SEO Description -->
<div id="popupDesc" class="desc-section">
  <div class="desc-title">Description</div>
  <div id="popupDescText" class="desc-content"></div>
</div>

<div class="quantity-bar premium-bar">
  <button onclick="changePopupQty(-1)">
    <svg viewBox="0 0 24 24" fill="none" width="20" height="20">
      <path d="M6 12h12" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  <div id="popupQty" class="quantity-display">1</div>
  <button onclick="changePopupQty(1)">
    <svg viewBox="0 0 24 24" fill="none" width="20" height="20">
      <path d="M12 6v12M6 12h12" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</div>
<!-- Add to Cart full-width button -->
<button id="popupAddBtn" style="width:100%; background:#2563eb; color:#fff; border:1px solid #2563eb; border-radius:8px; padding:12px 16px; font-size:15px; font-weight:500; cursor:pointer; font-family:'Roboto Slab', serif;">
  Add to Cart
</button>
<!-- Back button with Roboto Slab and border -->
<button onclick="closePopup()" style="width:100%; margin-top:10px; background:#f0f0f0; color:#333; border:1px solid #bbb; border-radius:8px; padding:10px 16px; font-size:14px; font-weight:500; cursor:pointer; font-family:'Roboto Slab', serif;">
  Back
</button>
</div>
</div>
</div>
<div id="addedToast" style="
  display: none;
  align-items: center;
  position: fixed;
  top: 25px;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  color: #fff;
  font-size: 14px;
  padding: 6px 12px;
  border-radius: 30px;
  z-index: 10000;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  font-weight: 500;
  gap: 10px;
  white-space: nowrap;
  height: 38px;
">
  <img src="https://i.postimg.cc/hG9Y3dJs/logooo.jpg" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />
  <span style="line-height: 1;">Item added to cart</span>
</div>
<script>

/* ====== SETTINGS ====== */
const WHATSAPP_NUMBER = "8586057887";
const BRAND_NAME = "precioussly";

/* ====== Description Generator ====== */
function generateSeoDescription(name) {
  const lower = (name || "").toLowerCase();
  const colors = ["red","blue","green","pink","black","white","purple","yellow","gold","silver","beige","brown","orange"];
  const colorFound = colors.find(c => lower.includes(c));
  const categories = [
    { keys:["necklace","pendant","locket"], label:"necklace", use:"daily wear, parties and gifting" },
    { keys:["ring"], label:"ring", use:"everyday elegance and special moments" },
    { keys:["bracelet","bangle"], label:"bracelet", use:"stacking or solo style" },
    { keys:["earring","stud","jhumka"], label:"earrings", use:"casual to festive looks" },
    { keys:["keychain","key ring","key-ring"], label:"keychain", use:"bag charm or keys" },
    { keys:["car","toy"], label:"mini collectible", use:"desk decor or gifting" },
  ];
  let cat = { label: "handmade piece", use: "gifting and everyday use" };
  for (const c of categories) {
    if (c.keys.some(k => lower.includes(k))) { cat = c; break; }
  }
  const niceName = name || "Beautiful Piece";
  const colorTxt = colorFound ? `${colorFound} ` : "";
  const line1 = `Premium ${colorTxt}${cat.label} — crafted for comfort and long-lasting shine.`;
  const line2 = `Perfect for ${cat.use}.`;
  const line3 = `Want a custom version? Message us on WhatsApp: ${WHATSAPP_NUMBER}.`;
  const line4 = BRAND_NAME;
  const sentence = `${niceName}: a premium ${colorTxt}${cat.label} designed for ${cat.use}. Lightweight, comfortable and gift-ready.`;
  return { bullets: [line1, line2, line3, line4], sentence };
}

/* ====== Inject JSON-LD Product schema (SEO) ====== */
function injectProductSchema({name, price, mrp, image, description}) {
  try {
    const id = "product-jsonld";
    const old = document.getElementById(id);
    if (old) old.remove();
    const data = {
      "@context":"https://schema.org",
      "@type":"Product",
      "name": name,
      "image": [image].filter(Boolean),
      "description": description,
      "brand": { "@type":"Brand", "name": BRAND_NAME },
      "offers": {
        "@type":"Offer",
        "priceCurrency":"INR",
        "price": String(price || ""),
        "availability":"https://schema.org/InStock",
        "url": location.href
      }
    };
    if (mrp && price && mrp > price) {
      data.offers["highPrice"] = String(mrp);
      data.offers["lowPrice"]  = String(price);
    }
    const tag = document.createElement("script");
    tag.type = "application/ld+json";
    tag.id = id;
    tag.textContent = JSON.stringify(data);
    document.head.appendChild(tag);
  } catch(e) {}
}

let selectedProduct = null;

// Open popup with product details
function openPopup(images, name, mrp, price, stock, sheetDesc) {
  selectedProduct = { image: images[0], name, mrp, price };
  // Build a shareable link that re-opens this popup
  const shareUrl = `${location.origin}${location.pathname}?p=${encodeURIComponent(name)}`;
  

  const whEl = document.getElementById('whShare');
  if (whEl) {
    whEl.href = `https://wa.me/?text=${encodeURIComponent(imageUrl)}%0A${encodeURIComponent(line1)}%0A${encodeURIComponent(shareUrl)}`;
    whEl.onclick = function() {
      const d = document.getElementById('popupDetails');
      if (d) d.open = false;
    };
  }

  try { history.replaceState(null, "", shareUrl); } catch (e) {}

  document.getElementById("popupQty").innerText = "1";

  // Inject product name and price
  document.getElementById("popupName").innerText = name;

  let priceHTML = "";
  if (mrp && price) {
  const discount = Math.round(((mrp - price) / mrp) * 100);
  priceHTML = `
    <div style="font-size:14px; display:flex; gap:6px; align-items:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
      <b>₹${price}</b>
      <s style="color:#999;">₹${mrp}</s>
      <span style="color:green; font-size:13px;">${discount}% off</span>
    </div>`;
  } else if (price) {
    priceHTML = `<b>₹${price}</b>`;
  } else {
    priceHTML = `<span style="color:#999;">Price not available</span>`;
  }

  document.getElementById("popupPrice").innerHTML = priceHTML;
// === Build description from Google Sheet (hide section if empty) ===
const descWrap = document.getElementById("popupDesc");
const descText = document.getElementById("popupDescText");
const fromSheet = (sheetDesc || "").trim();

// Reset state (in case previous product had a description)
if (descText) descText.textContent = "";

// Show only if non-empty
if (fromSheet.length > 0) {
  if (descWrap) descWrap.style.display = "block";
  if (descText) descText.textContent = fromSheet;
} else {
  if (descWrap) descWrap.style.display = "none";
}

// unified scroll handled by CSS on .popup-card


// ✅ SEO schema: use sheet description if present, else empty
injectProductSchema({
  name,
  price,
  mrp,
  image: images[0],
  description: fromSheet
});
// Add to cart button
  const popupBtn = document.getElementById("popupAddBtn");
  if (+stock === 0) {
    popupBtn.disabled = true;
    popupBtn.innerHTML = "Out of Stock";
  } else {
    popupBtn.disabled = false;
    popupBtn.innerHTML = "Add to Cart";
    popupBtn.onclick = function () {
  addToCartFromGrid(popupBtn, {
    photo: images[0],
    name,
    mrp,
    price,
    qty: parseInt(document.getElementById("popupQty").innerText) || 1
  });
};
  }

// Inject slider images (LIVE DRAG)
  const slider = document.getElementById("popupSlider");
  const dotsContainer = document.getElementById("popupDots");
  slider.innerHTML = "";
  if (dotsContainer) dotsContainer.innerHTML = "";

  // Build track + slides
  const track = document.createElement("div");
  track.className = "popup-track";
  slider.appendChild(track);

  let currentIndex = 0;
  const slides = [];
  const dots = [];

  images.forEach((url, i) => {
    const img = document.createElement("img");
    img.src = (url || "").trim();
    img.className = "popup-slide";
    img.setAttribute("draggable", "false");
    track.appendChild(img);
    slides.push(img);

    const dot = document.createElement("div");
    dot.className = "popup-dot" + (i === 0 ? " active" : "");
    dot.addEventListener("click", () => goTo(i));
    if (dotsContainer) dotsContainer.appendChild(dot);
    dots.push(dot);
  });

  // Hide dots if single or zero images; show otherwise
  if (dotsContainer){
    dotsContainer.style.display = (slides.length <= 1) ? "none" : "inline-flex";
  }

  function setActiveDot(i){
    dots.forEach((d, idx) => {
      if (idx === i) d.classList.add("active");
      else d.classList.remove("active");
    });
  }

  function width(){ return slider.getBoundingClientRect().width; }

  function goTo(i, animate=true) {
    if (!slides.length) return;
    if (i < 0) i = 0;
    if (i > slides.length - 1) i = slides.length - 1;
    
    const prevIndex = currentIndex;
currentIndex = i;
const dist = Math.max(1, Math.abs(prevIndex - currentIndex));
const base = 1400; // base ms (slower than before)
const extra = 200 * (dist - 1); // if jumping more than 1 slide
let dur = base + extra;
// Trim duration a bit for very fast swipes
if (window.__fastSwipe) dur = Math.max(420, base - 120);
track.style.transition = animate ? `transform ${dur}ms cubic-bezier(.22,1,.36,1)` : "none";
    track.style.transform = `translateX(${-i * width()}px)`;
    setActiveDot(i);
  }

  // Init position
  goTo(0, false);

  // Drag logic
  let startX = 0, dragStartX = 0, isDragging = false, lastMoveTime = 0, lastMoveX = 0;

  const onPointerDown = (e) => {
    if (e.pointerType === "mouse" && e.button !== 0) return;
    isDragging = true;
    slider.classList.add("dragging");
    track.style.transition = "none";
    startX = e.clientX;
    dragStartX = -currentIndex * width();
    lastMoveTime = Date.now();
    lastMoveX = startX;
    slider.setPointerCapture?.(e.pointerId);
  };

  const onPointerMove = (e) => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const atFirst = currentIndex === 0 && dx > 0;
    const atLast  = currentIndex === slides.length - 1 && dx < 0;
    const damp = (atFirst || atLast) ? 0.4 : 1;
    const pos = dragStartX + dx * damp;
    track.style.transform = `translateX(${pos}px)`;

    lastMoveTime = Date.now();
    lastMoveX = e.clientX;
  };

  const onPointerUp = (e) => {
    if (!isDragging) return;
    isDragging = false;
    slider.classList.remove("dragging");

    const dx = e.clientX - startX;
    const dt = Math.max(1, Date.now() - lastMoveTime);
    const velocity = (e.clientX - lastMoveX) / dt;
    const threshold = Math.min(160, width() * 0.25);
    const fast = Math.abs(velocity) > 0.6;

    let target = currentIndex;
    if (dx < -threshold || (fast && dx < 0)) target = currentIndex + 1;
    else if (dx > threshold || (fast && dx > 0)) target = currentIndex - 1;

    window.__fastSwipe = fast;
goTo(target, true);
    setTimeout(() => { window.__fastSwipe = false; }, 50);
slider.releasePointerCapture?.(e.pointerId);
  };

  slider.addEventListener("pointerdown", onPointerDown, { passive: true });
  slider.addEventListener("pointermove", onPointerMove,  { passive: true });
  slider.addEventListener("pointerup", onPointerUp,      { passive: true });
  slider.addEventListener("pointercancel", onPointerUp,  { passive: true });
  slider.addEventListener("pointerleave", onPointerUp,   { passive: true });

  window.addEventListener("resize", () => goTo(currentIndex, false), { passive: true });

  slider.tabIndex = 0;
  slider.addEventListener("keydown", (e) => {
    if (e.key === "ArrowRight") goTo(currentIndex + 1, true);
    if (e.key === "ArrowLeft")  goTo(currentIndex - 1, true);
  });

  // Show popup (ultra smooth)

// Show popup (ultra smooth)
const popup = document.getElementById("productPopup");
const card  = popup.querySelector(".popup-card");

popup.style.display = "flex";      // mount
// next frame -> add classes so transition runs
requestAnimationFrame(() => {
  popup.classList.add("is-open");
  card.classList.remove("leave");
  card.classList.add("enter");
});
document.body.classList.add("noscroll");

// Close popup
;
  card.addEventListener("transitionend", onDone);
}
// ✅ Quantity bar increase/decrease logic
function changePopupQty(change) {
  const qtyElement = document.getElementById("popupQty");
  let current = parseInt(qtyElement.innerText);
  current += change;
  if (current < 1) current = 1;
  if (current > 99) current = 99;
  qtyElement.innerText = current;
}
// Add to cart logic
function addToCartFromGrid(button, product) {
  const originalHTML = button.innerHTML;
  button.disabled = true;
  button.innerHTML = '<div class="fixed-spinner-wrapper"><span class="mini-spinner"></span></div>';

  setTimeout(() => {
    button.disabled = false;
    button.innerHTML = originalHTML;

    // Add item to cart
    let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
    const existing = cartItems.find(i => i.name === product.name);
if (existing) {
  existing.qty += product.qty || 1;  // ✅ Add correct qty if already exists
} else {
  cartItems.push({ ...product, qty: product.qty || 1 }); // ✅ Store correct qty
}

    localStorage.setItem("cartItems", JSON.stringify(cartItems));
    updateCartBadge();

    // Show toast
    const toast = document.getElementById("addedToast");
    toast.innerHTML = `
  <img src="https://i.postimg.cc/hG9Y3dJs/logooo.jpg" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">
  <span style="line-height:1;">Item added to cart</span>
`;
    toast.style.display = "flex";
    setTimeout(() => {
      toast.style.display = "none";
    }, 2000);
  }, 1000);
}
</script>
<script>
  // Announcement Bar from Google Sheet
  const announceSheetID = "1tjNd2zp77FVVdJQ181lhwSElZHgk3BT5Ma3_VM9Jafc";
  const announceURL = `https://opensheet.elk.sh/${announceSheetID}/Sheet1`;

  fetch(announceURL)
    .then(res => res.json())
    .then(data => {
      if (data.length > 0 && data[0]["(announcement_text)"]) {
        document.getElementById("announcementBar").innerText = data[0]["(announcement_text)"];
      }
    });
  
  function updateCartBadge(animate = true) {
  const items = JSON.parse(localStorage.getItem("cartItems")) || [];
  let count = 0;
  items.forEach(item => count += item.qty);

  const badge = document.getElementById("cartCountBadge");
  if (!badge) return;

  const prev = Number(badge.dataset.count || 0);

  if (count > 0) {
    badge.innerText = count;
    badge.style.display = "flex";

    if (animate && count !== prev) {
      badge.classList.remove("bounce-badge");
      void badge.offsetWidth;             // reflow
      badge.classList.add("bounce-badge");
      badge.addEventListener("animationend", () => {
        badge.classList.remove("bounce-badge");
      }, { once: true });
    }
  } else {
    badge.innerText = "";                  // ✅ no “0”
    badge.style.display = "none";          // ✅ hide when empty
  }

  badge.dataset.count = count;
}

updateCartBadge(false); // ✅ no bounce on refresh
</script>

<script>
function closePopup() {
  const popup = document.getElementById("productPopup");
  if (!popup) return;
  const card = popup.querySelector(".popup-card");
  if (!card) return;

  card.classList.remove("enter");
  card.classList.add("leave");
  popup.classList.remove("is-open");
  document.body.classList.remove("noscroll");

  const onDone = (e) => {
    if (e.target !== card) return;
    popup.style.display = "none";
  try { history.replaceState(null, "", location.pathname); } catch (e) {}
    card.removeEventListener("transitionend", onDone);
  };
  card.addEventListener("transitionend", onDone);
}

document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.getElementById("productPopup");
  if (!overlay) return;
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) closePopup();
  });
});
</script>


<script>
// identical function used on index.html
function toggleMenu(){
  const menu = document.getElementById("sideMenu");
  const overlay = document.getElementById("menuOverlay");
  const body = document.body;
  const open = menu.classList.contains("active");
  if (open){
    menu.classList.remove("active");
    overlay.classList.remove("active");
    body.classList.remove("no-scroll");
  }else{
    menu.classList.add("active");
    overlay.classList.add("active");
    body.classList.add("no-scroll");
  }
}
// Close on ESC
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    const menu = document.getElementById('sideMenu');
    if (menu && menu.classList.contains('active')) toggleMenu();
  }
});

// ===== MENU DATA FROM SHEET (same sheet as index.html) =====
const menuSheetID = "1C9AWqv9fv4deHYigCf6Zx0QlIg9xu4RD8MI3quI4Lag";
const menuURL = `https://opensheet.elk.sh/${menuSheetID}/Sheet1`;

fetch(menuURL)
  .then(res => res.json())
  .then(rows => {
    const menuContent = document.getElementById("menuContent");
    if (!menuContent) return;

    // Group by Menu with optional Submenu
    const grouped = {};
    rows.forEach(r => {
      const menu = (r.Menu || "").trim();
      const sub  = (r.Submenu || "").trim();
      const link = (r.Link || "").trim();
      if (!menu) return;
      if (sub){
        if (!grouped[menu]) grouped[menu] = { link:null, subs:[] };
        grouped[menu].subs.push({ name:sub, link });
      }else{
        grouped[menu] = { link, subs:[] };
      }
    });

    // Build top-level buttons (no dropdowns to match screenshot UX)
    Object.entries(grouped).forEach(([name, info]) => {
      const a = document.createElement('a');
      a.href = info.link || "#";
      a.className = "menu-link";
      a.textContent = name;
      menuContent.appendChild(a);
    });
  });
</script>


<script>
// Announcement bar
(function(){
  const announceSheetID = "1tjNd2zp77FVVdJQ181lhwSElZHgk3BT5Ma3_VM9Jafc";
  const announceURL = `https://opensheet.elk.sh/${announceSheetID}/Sheet1`;
  fetch(announceURL).then(r=>r.json()).then(d=>{
    if (d.length && d[0]["(announcement_text)"]) {
      const el = document.getElementById("announcementBar");
      if (el) el.innerText = d[0]["(announcement_text)"];
    }
  }).catch(()=>{});
})();
</script>


<!-- Floating Buttons: Back to Top + WhatsApp -->
<div class="fab-stack">
  <!-- Back to Top button -->
  <button id="toTopBtn" class="fab-btn" aria-label="Back to top" title="Back to top" style="display:none;">
    <svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 15l-6-6-6 6"></path>
    </svg>
  </button>

  <!-- WhatsApp button -->
  <a id="waBtn" class="fab-btn" aria-label="Chat on WhatsApp" title="Chat on WhatsApp" rel="noopener" target="_blank">
    <img src="https://i.postimg.cc/sxXh1J61/cropped-circle-image-1.png" alt="WhatsApp">
  </a>
</div>

<script>
// WhatsApp FAB link
(function(){
  const WA_NUMBER = "918586057887";
  const DEFAULT_MSG = "Hi Precioussly! I need help with my order.";
  const wa = document.getElementById("waBtn");
  if (wa){
    const msg = encodeURIComponent(DEFAULT_MSG);
    wa.href = `https://wa.me/${WA_NUMBER}?text=${msg}`;
  }
})();
</script>

<script>
// ✅ Minimal & reliable hide-on-scroll logic
(() => {
  const header = document.querySelector('.site-header');
  if (!header) return;

  let lastY = window.pageYOffset;

  const show = () => header.classList.remove('header-hidden');
  const hide = () => header.classList.add('header-hidden');

  const atTopOrSearching = () =>
    window.pageYOffset < 10 || header.classList.contains('searching');

  window.addEventListener('scroll', () => {
    const y = window.pageYOffset;
    const delta = y - lastY; // +ve = scrolling down, -ve = up

    // Top par ya search khula ho to hamesha dikhana
    if (atTopOrSearching()) { show(); lastY = y; return; }

    if (delta > 3) hide();      // thoda bhi neeche jaoge to hide
    else if (delta < -3) show(); // upar aate hi show

    lastY = y;
  }, { passive: true });
})();
</script>

<script>
// Back-to-top
(function(){
  const toTopBtn = document.getElementById("toTopBtn");
  if (!toTopBtn) return;
  window.addEventListener("scroll", () => {
    toTopBtn.style.display = (window.scrollY > 200) ? "flex" : "none";
  }, {passive:true});
  toTopBtn.addEventListener("click", () => window.scrollTo({top:0, behavior:"smooth"}));
})();
</script>

<script>
// Cart badge
function updateCartBadge(){
  const items = JSON.parse(localStorage.getItem("cartItems")) || [];
  let count = 0; items.forEach(i => count += i.qty || i.quantity || 0);
  const badge = document.getElementById("cartCountBadge");
  if (badge){
    if (count > 0){ badge.innerText = count; badge.style.display = "flex"; }
    else { badge.style.display = "none"; }
  }
}
if (document.readyState !== "loading") updateCartBadge();
else document.addEventListener("DOMContentLoaded", updateCartBadge);
</script>
<script>
/* ===== Auto Tabs Search Setup (Single Google Sheet → ALL its tabs) =====
   CONFIG: Set SHEET_ID below. You DO NOT need to list tab names.
   The script will auto-detect all sheet tabs (if the sheet is public or "Published to web").
   Fallback: If auto-detect fails, it will look for a tab named "Tabs" that lists tab names in column A.
   Final fallback: it will use only the first/default tab "Sheet1".
*/
const SHEET_ID_FOR_SEARCH = "1PFz3c1VNcmFo5NkN1xdpCyYxJJGxMlxt1Aw_tWv56nA"; // ✅ Your Google Sheet ID
const PAGE_FOR_RESULTS = location.pathname;  // open results on the same page

// Utility: fetch all tab names using the legacy public worksheet feed (works for public/published sheets)
async function listSheetTabs(sheetId){
  const url = `https://spreadsheets.google.com/feeds/worksheets/${sheetId}/public/basic?alt=json`;
  try{
    const res = await fetch(url, { cache: "no-store" });
    if(!res.ok) throw new Error("tab feed not ok");
    const data = await res.json();
    const entries = (data && data.feed && data.feed.entry) || [];
    const names = entries.map(e => (e.title && e.title.$t) || "").filter(Boolean);
    return Array.from(new Set(names));
  }catch(e){
    return []; // will try fallback
  }
}

// Fallback: read a "Tabs" sheet (first column) via opensheet if present
async function listTabsFromConfig(sheetId){
  try{
    const url = `https://opensheet.elk.sh/${sheetId}/Tabs`;
    const rows = await fetch(url).then(r => r.json());
    const names = (rows || []).map(r => (r["Tab"] || r["tab"] || r["name"] || r["Name"] || Object.values(r)[0] || "")).map(s => String(s).trim()).filter(Boolean);
    return Array.from(new Set(names));
  }catch(e){ return []; }
}

// Load data for one tab via opensheet
async function loadTabRows(sheetId, tabName){
  const url = `https://opensheet.elk.sh/${sheetId}/${encodeURIComponent(tabName)}`;
  const rows = await fetch(url).then(r => r.json());
  return rows;
}

// Build the global product list from ALL tabs
window.allProducts = []; // will be filled below

(async function buildAllProducts(){
  let tabs = await listSheetTabs(SHEET_ID_FOR_SEARCH);
  if(!tabs.length){
    tabs = await listTabsFromConfig(SHEET_ID_FOR_SEARCH);
  }
  if(!tabs.length){
    tabs = ["Sheet1"]; // last fallback
  }

  // Ignore very obvious non-catalog tabs
  const ignore = new Set(["Config","Menu","Announcement","Announcements","Buttons","Categories","Tabs","MENU","config","menu","tabs"]);
  const filteredTabs = tabs.filter(t => !ignore.has(t));

  const all = [];
  for (const tab of filteredTabs){
    try{
      const rows = await loadTabRows(SHEET_ID_FOR_SEARCH, tab);
      const items = (rows || [])
        .filter(row => (String(row["Product Name"] || "").trim().length > 0))
        .map(row => ({
          name: String(row["Product Name"]).trim(),
          price: Number(row["Selling Price"] || 0),
          mrp: Number(row["MRP"] || 0),
          image: row["photo 1"] || row["Photo 1"] || "",
          page: PAGE_FOR_RESULTS,
          from: tab
        }));
      all.push(...items);
    }catch(e){ /* skip tab on error */ }
  }
  window.allProducts = all;
})();

/* ========== UI wiring ========== */
const inputEl = document.getElementById('headerSearchInput');
const boxEl   = document.getElementById('headerSearchResults');

function openHeaderSearch(){
  const header = document.querySelector('.site-header');
  header.classList.add('searching');
  header.classList.remove('header-hidden');
  if (inputEl){ inputEl.value=''; setTimeout(()=>inputEl.focus(),30); }
  hideSuggest();
}
function closeHeaderSearch(){
  const header = document.querySelector('.site-header');
  header.classList.remove('searching');
  const bar = document.getElementById('headerSearchBar');
if (bar) bar.setAttribute('hidden','');
  hideSuggest();
}
function closeHeaderSearch(){
  const header = document.querySelector('.site-header');
  if(header) header.classList.remove('searching');
  hideSuggest();
}
function hideSuggest(){
  if(boxEl){ boxEl.style.display='none'; boxEl.innerHTML=''; }
}

/* Filter + render suggestions below the bar */
function renderSuggestions(q){
  const ql = (q||"").toLowerCase().trim();
  if(!ql){ hideSuggest(); return; }

  const list = (window.allProducts || []).filter(p => (p.name||"").toLowerCase().includes(ql));
  const top  = list.slice(0, 12); // max 12 items

  if(!top.length){ hideSuggest(); return; }

  boxEl.innerHTML = top.map(p => `
    <div class="header-suggest" onclick="goToProduct('${p.page}', '${(p.name||"").replace(/'/g,"\\'")}')">
      <img src="${p.image || 'https://i.postimg.cc/3N1J0J3S/file-000000-placeholder.png'}" alt="">
      <div>
        <div class="name">${p.name}</div>
        <div class="price">₹${p.price || '-'}</div>
      </div>
      <div class="tag">${p.from}</div>
    </div>
  `).join('');

  boxEl.style.display = 'block';
}

/* Go to that page and auto-open the product popup via ?p= */
function goToProduct(pagePath, productName){
  // Agar pagePath current file hi hai to same-page URL banega
  const base = location.origin;
  location.href = `${base}${pagePath}?p=${encodeURIComponent(productName)}`;
}

/* Typing events */
if (inputEl){
  inputEl.addEventListener('input', e => renderSuggestions(e.target.value));

  // Enter: first best match open, bina kisi unwanted redirect ke
  inputEl.addEventListener('keydown', e => {
    if(e.key === 'Enter'){
      e.preventDefault();
      const typed = (inputEl.value||'').trim();
      if(!typed){ closeHeaderSearch(); return; }

      const list = (window.allProducts || [])
        .filter(p => (p.name||"").toLowerCase().includes(typed.toLowerCase()));

      const chosen =
        list[0] ||
        (window.allProducts||[]).find(p => (p.name||"").toLowerCase() === typed.toLowerCase()) ||
        (window.allProducts||[]).find(p => (p.name||"").toLowerCase().startsWith(typed.toLowerCase())) ||
        (window.allProducts||[]).find(p => (p.name||"").toLowerCase().includes(typed.toLowerCase()));

      if (chosen){
        goToProduct(chosen.page, chosen.name);
      } else {
        // Fallback: isi page par typed name ke saath popup kholne ki koshish
        goToProduct(location.pathname, typed);
      }
    }
  });
}

// Expose for inline onclick
window.goToProduct = goToProduct;
window.openHeaderSearch = openHeaderSearch;
window.closeHeaderSearch = closeHeaderSearch;
</script>
<!-- A2_DIRECTION_TOGGLE :: JS helper -->
<script>
/* Reads A2 ("Box Direction") from the sheet rows.
   If it's 2 -> set <body class="horizontal-mode"> */

function applyDirectionFromSheet(rows){
  try{
    const first = rows?.[0] || {};
    const key = Object.keys(first).find(k => k.trim().toLowerCase() === "box direction");
    const value = Number(first[key] || first["Box Direction"] || 1);

    // Reset classes first
    document.body.classList.remove("horizontal-mode","small-cards");

    if (value === 2){
      // Mode 2: horizontal swipe (default card size)
      document.body.classList.add("horizontal-mode");
    } else if (value === 3){
      // Mode 3: horizontal swipe + smaller cards
      document.body.classList.add("horizontal-mode","small-cards");
    } // value === 1 -> normal grid (no extra class)
  }catch(e){}
}

</script>
<!-- 🟣 Instagram banner: EXACTLY below the pink certified-strip -->
<section class="ig-banner-wrap" id="igFollowBanner">
<div aria-label="Instagram updates banner" class="ig-banner">
<p>Stay connected with us for updates,<br/>offers &amp; behind-the-scenes ✨</p>
<a aria-label="Open our Instagram profile" class="ig-link" href="https://www.instagram.com/precioussly_" rel="noopener noreferrer" target="_blank">
<img alt="Instagram" class="ig-icon" src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png"/>
</a>
</div>
</section>
<!-- Hidden footer initially -->
<footer id="delayedFooter" 
        style="display:none; text-align:center; margin-top:30px; padding:10px 0; font-size:12px; color:#555; border-top:1px solid #ddd; position:relative; bottom:0; left:0; right:0;">
  © 2025 Precioussly. All rights reserved.
</footer>

<script>
  // Ensure footer sticks at bottom if content is short
  function adjustFooter() {
    const footer = document.getElementById("delayedFooter");
    if (!footer) return;
    const bodyHeight = document.body.scrollHeight;
    const winHeight = window.innerHeight;
    if (bodyHeight < winHeight) {
      footer.style.position = "fixed";
      footer.style.bottom = "0";
      footer.style.width = "100%";
      footer.style.background = "#fff";  // clean background
    } else {
      footer.style.position = "relative";
      footer.style.width = "100%";
    }
  }

  // Show footer 3 seconds after page load with fade-in
  window.addEventListener("load", function(){
    setTimeout(function(){
      const footer = document.getElementById("delayedFooter");
      footer.style.display = "block";
      footer.style.opacity = "0";
      footer.style.transition = "opacity 1s ease";
      requestAnimationFrame(() => { footer.style.opacity = "1"; });
      adjustFooter();
    }, 2000);
  });

  // Re-check if window is resized
  window.addEventListener("resize", adjustFooter);
</script>
<!-- Hidden footer initially -->
<footer id="delayedFooter" 
        style="display:none; text-align:center; margin-top:30px; padding:10px 0; font-size:12px; color:#555; border-top:1px solid #ddd; position:relative; bottom:0; left:0; right:0;">
  © 2025 Precioussly. All rights reserved.
</footer>

<script>
  // Ensure footer sticks at bottom if content is short
  function adjustFooter() {
    const footer = document.getElementById("delayedFooter");
    if (!footer) return;
    const bodyHeight = document.body.scrollHeight;
    const winHeight = window.innerHeight;
    if (bodyHeight < winHeight) {
      footer.style.position = "fixed";
      footer.style.bottom = "0";
      footer.style.width = "100%";
      footer.style.background = "#fff";  // clean background
    } else {
      footer.style.position = "relative";
      footer.style.width = "100%";
    }
  }

  // Show footer 3 seconds after page load with fade-in
  window.addEventListener("load", function(){
    setTimeout(function(){
      const footer = document.getElementById("delayedFooter");
      footer.style.display = "block";
      footer.style.opacity = "0";
      footer.style.transition = "opacity 1s ease";
      requestAnimationFrame(() => { footer.style.opacity = "1"; });
      adjustFooter();
    }, 200);
  });

  // Re-check if window is resized
  window.addEventListener("resize", adjustFooter);
</script>

<!-- === INSTANT POPUP BEHAVIOR (no animation) === -->
<script>
  (function(){
    const popup = document.getElementById('productPopup');
    const card  = popup ? popup.querySelector('.popup-card') : null;

    // Helper: instantly hide the popup
    function hideInstant(){
      if (!popup) return;
      popup.classList.remove('is-open');
      if (card) card.classList.remove('enter','leave');
      popup.style.display = 'none';
      document.body.classList.remove('noscroll');
    }

    // Override the existing closePopup to be instant + Back-friendly
    window.closePopup = function(){
      try {
        // If we opened via pushState, go back one step.
        if (history.state && history.state.popupOpen) {
          history.back();
          return; // popstate listener will hide
        }
      } catch(e){}
      // Fallback: hide right away
      hideInstant();
      try { history.replaceState(null, "", location.pathname); } catch(e) {}
    };

    // 1) Push a history state whenever the popup becomes visible
    if (popup){
      const obs = new MutationObserver(() => {
        // When display becomes flex => popup opened
        const isOpen = window.getComputedStyle(popup).display === 'flex';
        if (isOpen && !(history.state && history.state.popupOpen)) {
          try { history.pushState({ popupOpen: true }, "", location.href); } catch(e) {}
        }
      });
      obs.observe(popup, { attributes: true, attributeFilter: ['style', 'class'] });
    }

    // 2) Pressing Back closes the popup (without navigating away)
    window.addEventListener('popstate', (ev) => {
      // If popup is visible, close it instantly
      if (!popup) return;
      const isVisible = window.getComputedStyle(popup).display !== 'none';
      if (ev.state && ev.state.popupOpen) {
        // We're popping the popup state -> hide instantly
        hideInstant();
        // Restore clean URL (remove ?p= if any)
        try { history.replaceState(null, "", location.pathname); } catch(e) {}
      } else if (isVisible) {
        // Safety: if user pressed back and popup visible but no state, hide it
        hideInstant();
      }
    });
  })();
</script>





<style id="dot-hide-single-v2">
/* Only hide when flagged 'single'. Otherwise show inline-flex */
.popup-dots.single { display: none !important; }
</style>
<script id="dot-hide-script-v2">
(function(){
  function updateDotsVisibility(dots){
    if(!dots) return;
    var count = dots.querySelectorAll('.popup-dot').length;
    if(count <= 1){
      dots.classList.add('single');
    }else{
      dots.classList.remove('single');
    }
  }
  function bindObserver(dots){
    if(!dots || dots.__observerBound) return;
    var obs = new MutationObserver(function(){ updateDotsVisibility(dots); });
    obs.observe(dots, {childList: true, subtree: true});
    dots.__observerBound = true;
    // run a couple times to catch late DOM work
    updateDotsVisibility(dots);
    setTimeout(function(){ updateDotsVisibility(dots); }, 200);
    setTimeout(function(){ updateDotsVisibility(dots); }, 600);
  }
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.popup-dots').forEach(function(dots){
      bindObserver(dots);
    });
  });
  // If popup content is dynamic, re-check when body receives clicks (cheap global hook)
  document.addEventListener('click', function(e){
    var dots = document.querySelector('.popup-dots');
    if(dots){ updateDotsVisibility(dots); }
  }, true);
})();
</script>





<!-- === Photo Nav Buttons (translucent) + Pinch-zoom friendly === -->


<style id="photo-nav-buttons-css">
.popup-media { position: relative !important; touch-action: pinch-zoom !important; }
#popupSlider { touch-action: pinch-zoom !important; cursor: auto !important; }
.photo-nav-btn{
  position:absolute; top:50%; transform:translateY(-50%);
  width:44px; height:44px; border-radius:50%;
  background:rgba(120,120,120,0.72);
  border:1px solid rgba(0,0,0,0.18);
  box-shadow:0 4px 12px rgba(0,0,0,0.25);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; user-select:none; outline:none;
}
.photo-nav-btn svg{ width:20px; height:20px; stroke:#fff; }
.photo-prev{ left:12px; }
.photo-next{ right:12px; }
.photo-nav-btn[disabled]{ opacity:0.45; pointer-events:none; }
</style>




<!-- === Override: openPopup with button navigation (no swipe) === -->
<script id="openPopup-left-right-override">
(function(){
  // helper to safely set innerText/HTML
  function $(id){ return document.getElementById(id); }

  // Sanitize array of image URLs
  function okImages(arr){
    return (arr || []).map(u => (u||"").trim()).filter(Boolean);
  }

  window.openPopup = function(images, name, mrp, price, stock, sheetDesc){
    images = okImages(images);
    try {
      // Share link
      var shareUrl = location.origin + location.pathname + "?p=" + encodeURIComponent(name || "");
var imageUrl = (images && images[0]) ? String(images[0]) : "";
var line1 = "Check this on Precioussly: " + (name || "") + " — ₹" + (price || "");
var wh = $("whShare");
if (wh) {
  // WhatsApp preview hack: put product image URL first, then text line, then page link
  wh.href = "https://wa.me/?text=" + encodeURIComponent(imageUrl) + "%0A" + encodeURIComponent(line1) + "%0A" + encodeURIComponent(shareUrl);
}
history.replaceState && history.replaceState(null, "", shareUrl);
    } catch(e){}

    // Qty reset
    var qtyEl = $("popupQty"); if(qtyEl) qtyEl.innerText = "1";

    // Name + Price
    var nameEl = $("popupName"); if(nameEl) nameEl.innerText = name || "";
    var priceEl = $("popupPrice");
    if(priceEl){
      if (mrp && price){
        var discount = Math.round(((mrp - price)/mrp) * 100);
        priceEl.innerHTML =
          '<div style="font-size:14px; display:flex; gap:6px; align-items:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">' +
          '<b>₹'+price+'</b>' +
          '<s style="color:#999;">₹'+mrp+'</s>' +
          '<span style="color:green; font-size:13px;">'+discount+'% off</span>' +
          '</div>';
      } else if (price){
        priceEl.innerHTML = '<b>₹'+price+'</b>';
      } else {
        priceEl.innerHTML = '<span style="color:#999;">Price not available</span>';
      }
    }

    // Description from sheet (no auto bullets)
    var descWrap = $("popupDesc");
    var descText = $("popupDescText");
    var fromSheet = (sheetDesc||"").trim();
    if(descText) descText.textContent = "";
    if(fromSheet.length > 0){
      if(descWrap) descWrap.style.display = "block";
      if(descText) descText.textContent = fromSheet;
    }else{
      if(descWrap) descWrap.style.display = "none";
    }

    // SEO schema (if function exists)
    try{
      if (typeof injectProductSchema === "function"){
        injectProductSchema({ name, price, mrp, image: images[0] || "", description: fromSheet });
      }
    }catch(e){}

    // Add to Cart button
    var addBtn = $("popupAddBtn");
    if(addBtn){
      if (+stock === 0){
        addBtn.disabled = true;
        addBtn.innerHTML = "Out of Stock";
        addBtn.onclick = null;
      }else{
        addBtn.disabled = false;
        addBtn.innerHTML = "Add to Cart";
        addBtn.onclick = function(){
          var qty = parseInt(($("popupQty")||{}).innerText || "1", 10) || 1;
          if (typeof addToCartFromGrid === "function"){
            addToCartFromGrid(addBtn, { photo: images[0], name, mrp, price, qty });
          }
        };
      }
    }

    // Build slider (no swipe)
    var slider = $("popupSlider");
    var dotsContainer = $("popupDots");
    if (!slider) return;

    // Clear previous content
    slider.innerHTML = "";
    if (dotsContainer) dotsContainer.innerHTML = "";

    // Remove any old nav buttons from a previous open
    var media = slider.parentElement;
    if (media){
      Array.from(media.querySelectorAll(".photo-nav-btn")).forEach(n => n.remove());
    }

    // Track
    var track = document.createElement("div");
    track.className = "popup-track";
    slider.appendChild(track);

    // Slides + dots
    var slides = [], dots = [];
    images.forEach(function(url, i){
      var img = document.createElement("img");
      img.src = url;
      img.className = "popup-slide";
      img.setAttribute("draggable","false");
      img.style.touchAction = "pinch-zoom";
      track.appendChild(img);
      slides.push(img);

      if (dotsContainer){
        var dot = document.createElement("div");
        dot.className = "popup-dot" + (i===0 ? " active" : "");
        dot.addEventListener("click", function(){ goTo(i, true); });
        dotsContainer.appendChild(dot);
        dots.push(dot);
      }
    });

    // Hide dots if single/none
    if (dotsContainer){
      dotsContainer.style.display = (slides.length <= 1) ? "none" : "inline-flex";
    }

    function setActiveDot(i){
      dots.forEach(function(d, idx){
        if (idx === i) d.classList.add("active"); else d.classList.remove("active");
      });
    }

    function width(){ return slider.getBoundingClientRect().width; }

    var currentIndex = 0;
    function goTo(i, animate) {
      if (!slides.length) return;
      if (i < 0) i = 0;
      if (i > slides.length-1) i = slides.length-1;
      const prev = currentIndex;
currentIndex = i;
const dist = Math.max(1, Math.abs(prev - currentIndex));
const base = 1400; const extra = 220 * (dist - 1);
let dur = base + extra;
track.style.transition = (animate!==false) ? `transform ${dur}ms cubic-bezier(.22,1,.36,1)` : "none";
      track.style.transform = "translateX(" + (-i * width()) + "px)";
      setActiveDot(i);
      refreshNavState();
    }

    // Create nav buttons (prev/next)
    function mkBtn(cls, label, svgPath){
      var b = document.createElement("button");
      b.className = "photo-nav-btn " + cls;
      b.setAttribute("aria-label", label);
      b.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="'+svgPath+'"/></svg>';
      media && media.appendChild(b);
      return b;
    }
    var prevBtn = mkBtn("photo-prev", "Previous photo", "M15 18l-6-6 6-6");
    var nextBtn = mkBtn("photo-next", "Next photo", "M9 6l6 6-6 6");

    function refreshNavState(){
      if (!prevBtn || !nextBtn) return;
      if (slides.length <= 1){
        prevBtn.style.display = "none";
        nextBtn.style.display = "none";
      } else {
        prevBtn.style.display = "";
        nextBtn.style.display = "";
        prevBtn.disabled = (currentIndex === 0);
        nextBtn.disabled = (currentIndex === slides.length - 1);
      }
    }

    prevBtn && prevBtn.addEventListener("click", function(){ goTo(currentIndex - 1, true); });
    nextBtn && nextBtn.addEventListener("click", function(){ goTo(currentIndex + 1, true); });

    // Arrow key support
    slider.tabIndex = 0;
    slider.onkeydown = function(e){
      if (e.key === "ArrowRight") goTo(currentIndex + 1, true);
      if (e.key === "ArrowLeft")  goTo(currentIndex - 1, true);
    };

    // Resize
    window.addEventListener("resize", function(){ goTo(currentIndex, false); }, { passive: true });

    // Init
    goTo(0, false);

    // Open popup smoothly (uses existing CSS classes)
    var popup = $("productPopup");
    var card = popup ? popup.querySelector(".popup-card") : null;
    if (popup && card){
      popup.style.display = "flex";
      requestAnimationFrame(function(){
        popup.classList.add("is-open");
        card.classList.remove("leave");
        card.classList.add("enter");
      });
      document.body.classList.add("noscroll");
    }
  };
})();
</script>

<div class="pp-overlay" id="profilePopupOverlay" aria-hidden="true">
  <div class="pp-card" role="dialog" aria-modal="true" aria-labelledby="ppTitle">
    <button class="pp-back" id="ppBackBtn">Back</button>
    <div class="pp-hero"><div class="pp-badge">♡</div></div>
    <h3 class="pp-title" id="ppTitle">Precioussly for preciouss ones</h3>
    <p class="pp-sub">You can track your order 24 hours after placing it by clicking the ‘Track Order’ button.</p>
    <a class="pp-cta" id="ppTrackBtn" href="https://www.precioussly.com/track-order">Track Order</a>
  </div>
</div>

<script id="pink-profile-popup-js">
// === Pink Profile Popup (ChatGPT Resin) ===
(function(){
  const overlay = document.getElementById('profilePopupOverlay');
  const back = document.getElementById('ppBackBtn');
  function openPopup(){
    if(!overlay) return;
    overlay.classList.add('show');
    document.body.classList.add('no-scroll');
    overlay.setAttribute('aria-hidden','false');
  }
  function closePopup(){
    overlay.classList.remove('show');
    document.body.classList.remove('no-scroll');
    overlay.setAttribute('aria-hidden','true');
  }
  // Try to grab the profile icon
  const profileIcon = document.getElementById('profileIcon') ||
    document.querySelector('img[alt="Profile"], .icon-profile, .profile-icon, [data-profile]');
  if(profileIcon){
    profileIcon.style.cursor = 'pointer';
    profileIcon.addEventListener('click', openPopup, {passive:true});
  }
  if(back) back.addEventListener('click', closePopup);
  // tap outside to close
  if(overlay){
    overlay.addEventListener('click', function(e){
      if(e.target === overlay) closePopup();
    });
  }
})();</script>

<script>
// === Android Back Button: close popup instead of exiting ===
(function () {
  const POPUP_ID = 'productPopup';
  const popupEl = () => document.getElementById(POPUP_ID);
  const isOpen = () => {
    const el = popupEl();
    if (!el) return false;
    const ds = (el.style.display || '').toLowerCase();
    return el.classList.contains('is-open') || ds === 'flex' || ds === 'block';
  };

  // Ensure base state so first Back hits our handler
  try {
    if (!history.state || !history.state.__base) {
      history.replaceState({ __base: true }, "", location.href);
    }
  } catch (e) {}

  // Wrap openPopup to push one history state
  const __origOpenPopup = window.openPopup;
  if (typeof __origOpenPopup === "function") {
    window.openPopup = function() {
      try {
        if (!history.state || !history.state.__popup) {
          history.pushState({ __popup: true }, "", location.href);
        }
      } catch (e) {}
      return __origOpenPopup.apply(this, arguments);
    };
  }

  // Visual close without touching history
  function __forceClosePopup() {
    const el = popupEl();
    if (!el) return;
    el.classList.remove("is-open");
    el.style.display = "none";
    document.body.classList.remove("noscroll");
  }

  // Wrap closePopup so the UI Back button also uses history
  const __origClosePopup = window.closePopup;
  window.closePopup = function() {
    if (history.state && history.state.__popup) {
      try { history.back(); } catch (e) {}
      return;
    }
    __forceClosePopup();
    if (typeof __origClosePopup === "function") {
      try { __origClosePopup.apply(this, arguments); } catch (e) {}
    }
  };

  // Hardware/browser back
  window.addEventListener("popstate", function () {
    if (isOpen()) {
      __forceClosePopup();
      return;
    }
  });

  // Overlay click should also go through history when possible
  const el = popupEl();
  if (el) {
    el.addEventListener("click", function (e) {
      if (e.target === el) {
        if (history.state && history.state.__popup) {
          try { history.back(); } catch (e2) {}
        } else {
          __forceClosePopup();
        }
      }
    }, { passive: true });
  }
})();
</script>


<script>
// === Enhanced Back Handling: product popup + profile popup ===
(function () {
  function $(id){ return document.getElementById(id); }
  const product = () => $('productPopup');
  const profile = () => $('profilePopupOverlay');

  function productOpen(){
    const el = product();
    if(!el) return false;
    const ds = (el.style.display||'').toLowerCase();
    return el.classList.contains('is-open') || ds === 'flex' || ds === 'block';
  }
  function profileOpen(){
    const el = profile();
    if(!el) return false;
    const aria = el.getAttribute('aria-hidden');
    return el.classList.contains('show') || aria === 'false';
  }
  function closeProduct(){
    const el = product();
    if(!el) return;
    el.classList.remove('is-open');
    el.style.display = 'none';
    document.body.classList.remove('noscroll');
  }
  function closeProfile(){
    const el = profile();
    if(!el) return;
    el.classList.remove('show');
    el.setAttribute('aria-hidden','true');
    document.body.classList.remove('no-scroll');
  }

  // Base state so first Back is caught
  try {
    if (!history.state || !history.state.__base) {
      history.replaceState({ __base: true }, "", location.href);
    }
  } catch(e){}

  // Observe profile popup becoming visible -> push a state once
  const profEl = profile();
  if (profEl) {
    const pushIfNeeded = () => {
      if (profileOpen() && !(history.state && history.state.__profile)) {
        try { history.pushState({ __profile: true }, "", location.href); } catch(e){}
      }
    };
    const mo = new MutationObserver(pushIfNeeded);
    mo.observe(profEl, { attributes: true, attributeFilter: ['class','aria-hidden','style'] });
    // also bind its buttons to use history.back()
    const backBtn = $('ppBackBtn');
    if (backBtn) {
      backBtn.addEventListener('click', function(ev){
        if (history.state && history.state.__profile) {
          try { history.back(); ev.preventDefault(); } catch(e){}
        } else {
          closeProfile();
        }
      }, { passive: false });
    }
    // overlay click should also go through history
    profEl.addEventListener('click', function(e){
      if (e.target === profEl) {
        if (history.state && history.state.__profile) { try { history.back(); } catch(e){} }
        else { closeProfile(); }
      }
    }, { passive: true });
  }

  // Ensure product open pushes a state (safety in case wrapper missed)
  const prodEl = product();
  if (prodEl) {
    const mo2 = new MutationObserver(() => {
      if (productOpen() && !(history.state && history.state.__product)) {
        try { history.pushState({ __product: true }, "", location.href); } catch(e){}
      }
    });
    mo2.observe(prodEl, { attributes: true, attributeFilter: ['class','style'] });
  }

  // BACK button / gesture
  window.addEventListener('popstate', function(){
    if (productOpen()) { closeProduct(); return; }
    if (profileOpen()) { closeProfile(); return; }
  });
})();
</script>

</body>
</html>

</body>
</html>
